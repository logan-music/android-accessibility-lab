name: Generate Gradle Wrapper & Upload

on:
  workflow_dispatch:

jobs:
  gen-wrapper:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Java 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'

      - name: Setup Gradle CLI 7.5
        uses: gradle/actions/setup-gradle@v4
        with:
          gradle-version: '7.5'

      - name: Ensure android dir exists
        run: |
          if [ ! -d android ]; then
            echo "No android/ directory found in repo. Exiting."
            exit 1
          fi

      - name: Generate Gradle wrapper if missing
        working-directory: android
        run: |
          set -euo pipefail
          if [ ! -f gradle/wrapper/gradle-wrapper.jar ]; then
            echo "gradle-wrapper.jar missing â€” generating wrapper (7.5)..."
            gradle wrapper --gradle-version 7.5
          else
            echo "gradle wrapper already exists"
          fi
          # ensure wrapper script is executable if present
          if [ -f ./gradlew ]; then
            chmod +x ./gradlew || true
          fi

      - name: List wrapper files
        working-directory: android
        run: |
          echo "Listing gradle wrapper files:"
          ls -la gradle || true
          ls -la gradle/wrapper || true
          ls -la ./gradlew || true

      - name: Upload gradle wrapper artifact
        uses: actions/upload-artifact@v4
        with:
          name: gradle-wrapper-files
          path: |
            android/gradle
            android/gradlew
            android/gradlew.bat
